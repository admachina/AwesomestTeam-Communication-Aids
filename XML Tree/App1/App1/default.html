<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>App1</title>

    <!-- WinJS references -->
    <!--<link href="//Microsoft.WinJS.1.0/css/ui-dark.css" rel="stylesheet" />
    <script src="//Microsoft.WinJS.1.0/js/base.js"></script>
    <script src="//Microsoft.WinJS.1.0/js/ui.js"></script>-->

    <!-- App1 references -->
    <link href="./css/default.css" rel="stylesheet" />
    <link href="./css/modaldbox.css" rel="stylesheet" />
    <script src="./js/base.js"></script>
    <script src="./js/modaldbox.js"></script>
    <script src="./js/model.js"></script>
    <script src="./js/view.js"></script>
    <script src="./js/file.js"></script>
    <script src="./js/action.js"></script>
    <!--<script src="./js/default.js"></script>-->
    <script>
        var moved = false;
        var out = false;
        function save() {
            //File.saveFile(Model.generateXmlString(), "tree.xml");
            var str = Model.generateXmlString();
            document.getElementById("textbox").textContent = str;
        }
        function load() {
            /*File.openFile().then(function (result) {
                if (result !== null) {
                    View.drawTree(Model.generateTreeFromXmlString(result));
                }
            });*/
            View.drawTree(Model.generateTreeFromXmlString("<?xml version=\"1.0\" encoding=\"UTF-8\"?><Tree><DisplayValue></DisplayValue><PrintValue></PrintValue><IsRoot>TRUE</IsRoot><IsGoUp>FALSE</IsGoUp><Children><Tree><DisplayValue>Letters</DisplayValue><PrintValue></PrintValue><IsRoot>true</IsRoot><IsGoUp>FALSE</IsGoUp><Children><Tree><DisplayValue>space</DisplayValue><PrintValue>space</PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children></Children></Tree><Tree><DisplayValue>RAIO</DisplayValue><PrintValue></PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children><Tree><DisplayValue>R</DisplayValue><PrintValue>R</PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children></Children></Tree><Tree><DisplayValue>A</DisplayValue><PrintValue>A</PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children></Children></Tree><Tree><DisplayValue>I</DisplayValue><PrintValue>I</PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children></Children></Tree><Tree><DisplayValue>O</DisplayValue><PrintValue>O</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree></Children></Tree><Tree><DisplayValue>NTES</DisplayValue><PrintValue></PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children><Tree><DisplayValue>N</DisplayValue><PrintValue>N</PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children></Children></Tree><Tree><DisplayValue>T</DisplayValue><PrintValue>T</PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children></Children></Tree><Tree><DisplayValue>E</DisplayValue><PrintValue>E</PrintValue><IsRoot>FALSE</IsRoot><IsGoUp>FALSE</IsGoUp><Children></Children></Tree><Tree><DisplayValue>S</DisplayValue><PrintValue>S</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree></Children></Tree><Tree><DisplayValue>More...</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>H</DisplayValue><PrintValue>H</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>FMLD</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>F</DisplayValue><PrintValue>F</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>M</DisplayValue><PrintValue>M</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>L</DisplayValue><PrintValue>L</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>D</DisplayValue><PrintValue>D</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree></Children></Tree><Tree><DisplayValue>PCUY</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>P</DisplayValue><PrintValue>P</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>C</DisplayValue><PrintValue>C</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>U</DisplayValue><PrintValue>U</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>Y</DisplayValue><PrintValue>Y</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree></Children></Tree><Tree><DisplayValue>More...</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>BWG</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>B</DisplayValue><PrintValue>B</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>W</DisplayValue><PrintValue>W</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>G</DisplayValue><PrintValue>G</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>Go Back</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>true</IsGoUp><Children></Children></Tree></Children></Tree><Tree><DisplayValue>More...</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>J</DisplayValue><PrintValue>J</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>K</DisplayValue><PrintValue>K</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>V</DisplayValue><PrintValue>V</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>More...</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>Q</DisplayValue><PrintValue>Q</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>Z</DisplayValue><PrintValue>Z</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>X</DisplayValue><PrintValue>X</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>Go Back</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>true</IsGoUp><Children></Children></Tree></Children></Tree></Children></Tree><Tree><DisplayValue>Go Back</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>true</IsGoUp><Children></Children></Tree></Children></Tree></Children></Tree></Children></Tree><Tree><DisplayValue>Words</DisplayValue><PrintValue></PrintValue><IsRoot>true</IsRoot><IsGoUp>FALSE</IsGoUp><Children><Tree><DisplayValue>pronoun</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>I </DisplayValue><PrintValue>I </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>you </DisplayValue><PrintValue>you </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>we </DisplayValue><PrintValue>we </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree></Children></Tree><Tree><DisplayValue>verb</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>would</DisplayValue><PrintValue>would</PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>like </DisplayValue><PrintValue>like </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>do </DisplayValue><PrintValue>do </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>More...</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>know </DisplayValue><PrintValue>know </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>come </DisplayValue><PrintValue>come </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>can </DisplayValue><PrintValue>can </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>watch </DisplayValue><PrintValue>watch </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree></Children></Tree></Children></Tree><Tree><DisplayValue>question</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>who </DisplayValue><PrintValue>who </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>what </DisplayValue><PrintValue>what </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>why </DisplayValue><PrintValue>why </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>More...</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>where </DisplayValue><PrintValue>where </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>when </DisplayValue><PrintValue>when </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>how </DisplayValue><PrintValue>how </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree></Children></Tree></Children></Tree><Tree><DisplayValue>Other</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>a </DisplayValue><PrintValue>a </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>to </DisplayValue><PrintValue>to </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>over </DisplayValue><PrintValue>over </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>More...</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children><Tree><DisplayValue>not </DisplayValue><PrintValue>not </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>and </DisplayValue><PrintValue>and </PrintValue><IsRoot>false</IsRoot><IsGoUp>false</IsGoUp><Children></Children></Tree><Tree><DisplayValue>Go back</DisplayValue><PrintValue></PrintValue><IsRoot>false</IsRoot><IsGoUp>true</IsGoUp><Children></Children></Tree></Children></Tree></Children></Tree></Children></Tree></Children></Tree>"));
        }
        function canvasMouseDown(eventInfo) {
            moved = false;
            out = false;
            var subtreeInfo = View.getSubtree(eventInfo.offsetX, eventInfo.offsetY);
            if (subtreeInfo.tree instanceof Model.tree) {
                Actions.setSelected(subtreeInfo.tree, eventInfo.offsetX, eventInfo.offsetY, subtreeInfo.parent, subtreeInfo.parentIndex);
            }
        }
        function canvasMouseMove(eventInfo) {
            moved = true;
            Actions.moveTo(eventInfo.offsetX, eventInfo.offsetY);
        }
        function canvasMouseUp(eventInfo) {
            if (moved && !out) Actions.drop(eventInfo.offsetX, eventInfo.offsetY);
            if (!moved) Actions.reset();
        }
        function canvasMouseOut(eventInfo) {
            out = true;
            moved = true;
            Actions.reset();
        }
        function canvasMouseClick(eventInfo) {
            if (moved || out) return;

            var subtree = View.getSubtree(eventInfo.offsetX, eventInfo.offsetY);
            if (subtree.tree instanceof Model.tree) {
                Actions.changeNode(subtree.tree);
            }
        }

        function start() {
            View.initView();
            View.clearCanvas();
        }

    </script>
</head>
<body onload="start();initmb();">
    <div id="options" class="dialog">
        <div style="text-align:center"><span id="txt">What do you want to do?</span><br>
            <button onclick="hm('options');addChild()">Add Child</button>
            <button onclick="hm('options');rename()">Rename</button>
            <button onclick="hm('options');setRoot()">Set as Root</button>
            <button onclick="hm('options');setGoBack()">Set to Go Up a Menu</button>
            <button onclick="hm('options');clearSettings()">Clear Advanced Settings</button>
            <button onclick="hm('options');cancel()">Cancel</button>
        </div>
    </div>
    <div style="width:100px; height:100px; overflow:auto">
    <canvas id="drawingCanvas" width="10000" height="1080" onmousedown="canvasMouseDown(event)" onmousemove="canvasMouseMove(event)" onmouseup="canvasMouseUp(event)" onmouseout="canvasMouseOut(event)" onclick="canvasMouseClick(event)"></canvas>
    </div>
    
    <button id="save" onclick="save()">Save</button>
    <button id="load" onclick="load()">Load</button>

    <textarea id="textbox" style="visibility:hidden;"/>
</body>
</html>
