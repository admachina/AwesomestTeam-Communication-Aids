<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>App1</title>

    <!-- WinJS references -->
    <link href="//Microsoft.WinJS.1.0/css/ui-dark.css" rel="stylesheet" />
    <script src="//Microsoft.WinJS.1.0/js/base.js"></script>
    <script src="//Microsoft.WinJS.1.0/js/ui.js"></script>

    <!-- App1 references -->
    <link href="/css/default.css" rel="stylesheet" />
    <script src="/js/model.js"></script>
    <script src="/js/view.js"></script>
    <script src="/js/file.js"></script>
    <script src="/js/action.js"></script>
    <script src="/js/default.js"></script>
    <script>
        var moved = false;
        var out = false;
        function save() {
            File.saveFile(Model.generateXmlString(), "tree.xml");
        }
        function load() {
            File.openFile().then(function (result) {
                if (result !== null) {
                    View.drawTree(Model.generateTreeFromXmlString(result));
                }
            });
        }
        function canvasMouseDown(eventInfo) {
            moved = false;
            out = false;
            var subtreeInfo = View.getSubtree(eventInfo.offsetX, eventInfo.offsetY);
            if (subtreeInfo.tree instanceof Model.tree) {
                Actions.setSelected(subtreeInfo.tree, eventInfo.offsetX, eventInfo.offsetY, subtreeInfo.parent, subtreeInfo.parentIndex);
            }
        }
        function canvasMouseMove(eventInfo) {
            moved = true;
            Actions.moveTo(eventInfo.offsetX, eventInfo.offsetY);
        }
        function canvasMouseUp(eventInfo) {
            if (moved && !out) Actions.drop(eventInfo.offsetX, eventInfo.offsetY);
            if (!moved) Actions.reset();
        }
        function canvasMouseOut(eventInfo) {
            out = true;
            moved = true;
            Actions.reset();
        }
        function canvasMouseClick(eventInfo) {
            if (moved || out) return;

            var popup = new Windows.UI.Popups.PopupMenu();
            popup.commands.append(new Windows.UI.Popups.UICommand("Text"));
            popup.showAsync();


            //window.prompt("Add Which Letter?", "A");
        }

    </script>
</head>
<body>
    <canvas id="drawingCanvas" width="1920" height="1080" onmousedown="canvasMouseDown(event)" onmousemove="canvasMouseMove(event)" onmouseup="canvasMouseUp(event)" onmouseout="canvasMouseOut(event)" onclick="canvasMouseClick(event)"></canvas>
    <button id="save" onclick="save()">Save</button>
    <button id="load" onclick="load()">Load</button>
</body>
</html>
